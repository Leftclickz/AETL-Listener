# AETL-Listener
Created by __*Dayton Heywood*__ for CeeCam Corporation
Updated: 07/05/2020

## Description

AETL-Listener is a program that works alongside **AETL-Generator** (the Master) to watch for Adobe After Effects project files and feed them into the Adobe After Effects renderer.
After rendering the unencodeded video, the listener then encodes the video using FFMPEG with all specified resolutions.
After encoding all video files,  they are uploaded to the ceeplayer server where they can be hosted for clients.

This program is intended to be run alongside many other computers also running this program watching a _'hot folder'_ where AETL-Generator will be generating said project files. 

There are built-in safety checks to ensure Listeners don't grab the same project as well as the possibility that a Listener attempts to
grab an incomplete project file:
- When a project is collected it is renamed and locked out of the hot folder, preventing other listeners from accessing it.
- Whenever AETL-Generator is producing fresh project files, a lockfile is generated. AETL-Listener will detect this lockfile
will no longer pick up additional project files until it is removed by AETL-Generator (once it's done creating project files).
Note: AETL-Listener will still render video footage if the lockfile showed up AFTER picking up a project to render.

With multiple computers running AETL-Listener and a singular master running AETL-Generator every week, you can reliably expect video footage to update every week with new data without any user input whatsoever.

## Requirements

	Adobe After Effects CC
	FFMPEG (included)
	CURL (included)
	Internet connection
	AETL-Generator
	
## How To Use

AETL-Listener has multiple command-line arguments that are supported. Many need to be included to run.

 	-i 		: This is where your hot folder is located. This should be wherever AETL-Generator is generating the project files.
 	-ae 		: This must be an absolute path to aerender.exe (this is an executable located in your Adober After Effects directory)
	-o 		: This is where you expect the avi files to render to. This should be the same as what is in AETL-Generator.
	-db 		: Flag to specify a sqlite3 database to read from. If used the program will ignore the hosted Postgres database.
	-usage		: Specify the maximum space the scratch disk is allowed to allocate. Value in percent.
	-e		: This is where encoded videos should be placed.
	-res		: comma-delimited list of resolutions. Supports numbers and 'native'.
	-test		: Testing mode. Used to upload to the test server.
	-forceupload	: Force-upload mode. Requires {PID}-{LID} string. Will upload all related files to that project.

## Usage

AETL-Listener is intended to run silently in the background and uses almost no CPU when not actively processing project files. 

When AETL-Listener finds a project file it can work with, it will "lock" it, preventing other Listeners from accessing it. The lock will be timestamped for archiving purposes.

## AETL Database Usage

AETL-Listener uses the database generated by AETL-Generator to help facilitate future program executions. The listener will log
any attempts at rendering as well as log success/failed renders into the database. This can help track if something goes wrong
but its primary purpose is so AETL-Generator doesn't create duplicate project files for monthly projects. By default the program will use
an internally known Postgres database but can be forced to use a sqlite3 database (deprecated).